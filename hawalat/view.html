<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>عرض الطلبات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f8;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #6a0dad;
      color: white;
      padding: 10px 0;
      margin-bottom: 20px;
    }
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
      font-size: 18px; /* <-- هنا كبرت حجم الخط للجدول فقط */
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
    }
    th {
      background-color: #6a0dad;
      color: white;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      background-color: #6a0dad;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #580e9d;
    }
    #totals {
      margin: 20px;
      font-size: 18px;
    }
    select {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<header>
  <h1>عرض الطلبات</h1>
</header>

<div id="controls">
  <select id="clientSelect">
    <option value="">اختيار عميل</option>
  </select>
  <button onclick="deleteAll()">حذف الكل</button>
  <button onclick="printTable()">طباعة</button>
  <button onclick="exportToPDF()">تصدير PDF</button>
</div>

<table id="ordersTable">
  <thead>
    <tr>
      <th>اسم العميل</th>
      <th>التاريخ</th>
      <th>سعر الطلب</th>
      <th>سعر التوصيل</th>
      <th>المبلغ المدفوع</th>
      <th>الصورة</th>
      <th>ملاحظات</th>
      <th>تعديل</th>
      <th>حذف</th>
    </tr>
  </thead>
  <tbody>
    <!-- يتم تعبئته بالجافاسكربت -->
  </tbody>
</table>

<div id="totals">
  <p id="totalOrders"></p>
  <p id="totalDelivery"></p>
  <p id="totalPaid"></p>
  <p id="overallTotal"></p>
</div>

<script>
let orders = JSON.parse(localStorage.getItem('orders')) || [];

function renderTable() {
  const tableBody = document.querySelector('#ordersTable tbody');
  const clientSelect = document.getElementById('clientSelect');
  tableBody.innerHTML = '';
  clientSelect.innerHTML = '<option value="">اختيار عميل</option>';

  let totalOrders = 0;
  let totalDelivery = 0;
  let totalPaid = 0;
  let clients = new Set();

  orders.forEach((order, index) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${order.clientName}</td>
      <td>${order.date}</td>
      <td>${order.orderPrice}</td>
      <td>${order.deliveryPrice}</td>
      <td>${order.paidAmount}</td>
      <td>${order.image ? `<a href="${order.image}" target="_blank">عرض</a>` : 'لا يوجد'}</td>
      <td>${order.notes || ''}</td>
      <td><button onclick="editOrder(${index})">تعديل</button></td>
      <td><button onclick="deleteOrder(${index})">حذف</button></td>
    `;
    tableBody.appendChild(row);

    totalOrders += Number(order.orderPrice) || 0;
    totalDelivery += Number(order.deliveryPrice) || 0;
    totalPaid += Number(order.paidAmount) || 0;
    clients.add(order.clientName);
  });

  document.getElementById('totalOrders').textContent = `إجمالي الطلبات: ${totalOrders}`;
  document.getElementById('totalDelivery').textContent = `إجمالي التوصيل: ${totalDelivery}`;
  document.getElementById('totalPaid').textContent = `إجمالي المدفوع: ${totalPaid}`;
  document.getElementById('overallTotal').textContent = `المجموع الكلي: ${totalPaid - (totalOrders + totalDelivery)}`;

  clients.forEach(client => {
    const option = document.createElement('option');
    option.value = client;
    option.textContent = client;
    clientSelect.appendChild(option);
  });
}

function editOrder(index) {
  const order = orders[index];
  const newOrderPrice = prompt('تعديل سعر الطلب:', order.orderPrice);
  const newDeliveryPrice = prompt('تعديل سعر التوصيل:', order.deliveryPrice);
  const newPaidAmount = prompt('تعديل المبلغ المدفوع:', order.paidAmount);
  const newNotes = prompt('تعديل الملاحظات:', order.notes || '');

  if (newOrderPrice !== null) orders[index].orderPrice = newOrderPrice;
  if (newDeliveryPrice !== null) orders[index].deliveryPrice = newDeliveryPrice;
  if (newPaidAmount !== null) orders[index].paidAmount = newPaidAmount;
  if (newNotes !== null) orders[index].notes = newNotes;

  localStorage.setItem('orders', JSON.stringify(orders));
  alert('تم التعديل بنجاح');
  renderTable();
}

function deleteOrder(index) {
  if (confirm('هل أنت متأكد من حذف هذا الطلب؟')) {
    orders.splice(index, 1);
    localStorage.setItem('orders', JSON.stringify(orders));
    renderTable();
  }
}

function deleteAll() {
  if (confirm('هل أنت متأكد من حذف جميع الطلبات؟')) {
    orders = [];
    localStorage.removeItem('orders');
    renderTable();
  }
}

function printTable() {
  window.print();
}

function exportToPDF() {
  const table = document.getElementById('ordersTable');
  const win = window.open('', '', 'height=700,width=700');
  win.document.write('<html><head><title>تصدير PDF</title>');
  win.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #000; padding: 8px; font-size: 14px; }</style>');
  win.document.write('</head><body>');
  win.document.write(table.outerHTML);
  win.document.write('</body></html>');
  win.document.close();
  win.print();
}

document.getElementById('clientSelect').addEventListener('change', function() {
  const selectedClient = this.value;
  if (selectedClient === "") {
    renderTable();
    return;
  }

  const tableBody = document.querySelector('#ordersTable tbody');
  tableBody.innerHTML = '';

  orders.forEach((order, index) => {
    if (order.clientName === selectedClient) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${order.clientName}</td>
        <td>${order.date}</td>
        <td>${order.orderPrice}</td>
        <td>${order.deliveryPrice}</td>
        <td>${order.paidAmount}</td>
        <td>${order.image ? `<a href="${order.image}" target="_blank">عرض</a>` : 'لا يوجد'}</td>
        <td>${order.notes || ''}</td>
        <td><button onclick="editOrder(${index})">تعديل</button></td>
        <td><button onclick="deleteOrder(${index})">حذف</button></td>
      `;
      tableBody.appendChild(row);
    }
  });
});

renderTable();
</script>

</body>
</html>
