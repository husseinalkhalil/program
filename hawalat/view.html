<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>عرض الطلبات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f0ff;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    h1 {
      color: #6a3093;
      text-align: center;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background-color: #6a3093;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .btn {
      background-color: #6a3093;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-danger {
      background-color: #dc3545;
    }
    .btn-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .search-box {
      padding: 10px;
      width: 300px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .summary {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>عرض جميع الطلبات</h1>
    
    <div class="btn-group">
      <div>
        <input type="text" id="searchInput" class="search-box" placeholder="بحث في الطلبات...">
        <button onclick="searchOrders()" class="btn">بحث</button>
      </div>
      <div>
        <button onclick="window.location.href='index.html'" class="btn">إضافة طلب جديد</button>
        <button onclick="deleteAllOrders()" class="btn btn-danger">حذف الكل</button>
      </div>
    </div>
    
    <table id="ordersTable">
      <thead>
        <tr>
          <th>#</th>
          <th>وصف الطلب</th>
          <th>سعر التوصيل</th>
          <th>تاريخ الإرسال</th>
          <th>ملاحظات</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
    <div class="summary">
      <div>عدد الطلبات: <span id="totalOrders">0</span></div>
      <div>إجمالي سعر التوصيل: <span id="totalPrice">0</span> ريال</div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      loadOrders();
    });

    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const tbody = document.querySelector('#ordersTable tbody');
      tbody.innerHTML = '';
      
      let totalPrice = 0;
      
      if (orders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">لا توجد طلبات مسجلة</td></tr>';
      } else {
        orders.forEach((order, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${order.name || ''}</td>
            <td>${order.sar || '0'} ريال</td>
            <td>${order.date || ''}</td>
            <td>${order.notes || ''}</td>
            <td>
              <button onclick="editOrder(${index})" class="btn">تعديل</button>
              <button onclick="deleteOrder(${index})" class="btn btn-danger">حذف</button>
            </td>
          `;
          tbody.appendChild(row);
          
          totalPrice += parseFloat(order.sar) || 0;
        });
      }
      
      document.getElementById('totalOrders').textContent = orders.length;
      document.getElementById('totalPrice').textContent = totalPrice.toFixed(2);
    }
    
    function searchOrders() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const filteredOrders = orders.filter(order => 
        order.name.toLowerCase().includes(searchTerm) || 
        (order.notes && order.notes.toLowerCase().includes(searchTerm))
      );
      
      const tbody = document.querySelector('#ordersTable tbody');
      tbody.innerHTML = '';
      
      if (filteredOrders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">لا توجد نتائج</td></tr>';
      } else {
        filteredOrders.forEach((order, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${order.name || ''}</td>
            <td>${order.sar || '0'} ريال</td>
            <td>${order.date || ''}</td>
            <td>${order.notes || ''}</td>
            <td>
              <button onclick="editOrder(${orders.findIndex(o => o.name === order.name)})" class="btn">تعديل</button>
              <button onclick="deleteOrder(${orders.findIndex(o => o.name === order.name)})" class="btn btn-danger">حذف</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
    }
    
    function deleteOrder(index) {
      if (confirm('هل أنت متأكد من حذف هذا الطلب؟')) {
        const orders = JSON.parse(localStorage.getItem('orders'));
        orders.splice(index, 1);
        localStorage.setItem('orders', JSON.stringify(orders));
        loadOrders();
      }
    }
    
    function deleteAllOrders() {
      if (confirm('هل أنت متأكد من حذف جميع الطلبات؟')) {
        localStorage.setItem('orders', JSON.stringify([]));
        loadOrders();
      }
    }
    
    function editOrder(index) {
      const orders = JSON.parse(localStorage.getItem('orders'));
      const order = orders[index];
      
      const newName = prompt('وصف الطلب:', order.name);
      if (newName === null) return;
      
      const newPrice = prompt('سعر التوصيل:', order.sar);
      if (newPrice === null) return;
      
      const newDate = prompt('تاريخ الإرسال:', order.date);
      if (newDate === null) return;
      
      const newNotes = prompt('ملاحظات:', order.notes);
      if (newNotes === null) return;
      
      orders[index] = {
        name: newName,
        sar: newPrice,
        date: newDate,
        notes: newNotes
      };
      
      localStorage.setItem('orders', JSON.stringify(orders));
      loadOrders();
    }
  </script>
</body>
</html>
