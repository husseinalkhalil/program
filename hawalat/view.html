<?php
$articles = [
    [
        'title' => '❖ أعراض فهم الدين بالمقلوب',
        'content' => '1- تؤمن بأن الكلب نجس...', // المحتوى الكامل
        'date' => '2023-12-25'
    ],
    [
        'title' => '❖ الباحث عن الأضواء',
        'content' => 'في ساحة الفكر والتدبر...',
        'date' => '2024-01-10'
    ],
    [
        'title' => '❖ شتيمة أهل النقل شهادة لأهل العقل',
        'content' => 'في المجتمعات التي تقدّس...',
        'date' => '2024-01-15'
    ],
    [
        'title' => '❖ هوامش على الطريق',
        'content' => 'هناك نوع من الأشخاص...',
        'date' => '2024-02-01'
    ],
    [
        'title' => '❖ وهم الحواس في الإلحاد، الحقيقة أوسع مما يُرى.',
        'content' => 'كثيرون ممن ينكرون...',
        'date' => '2024-02-10'
    ],
    [
        'title' => '❖ دعهم يتكلمون، وواصل طريقك بسلام.',
        'content' => 'في هذه الحياة...',
        'date' => '2024-03-05'
    ],
    [
        'title' => '❖ ازدواجية الضمير',
        'content' => 'في عالم يزعم...',
        'date' => '2024-03-15'
    ],
    [
        'title' => '❖ الجدال مع المؤدلجين، معركة خاسرة.',
        'content' => 'كم مرة وجدت...',
        'date' => '2024-04-01'
    ],
    [
        'title' => '❖ لا تسعَ لإرضاء أحد.',
        'content' => 'منذ الأزل...',
        'date' => '2024-04-10'
    ],
    [
        'title' => '❖ مما قرأت وأعجبني في مسألة قبول الاختلاف والتعايش بين البشر',
        'content' => '1- أنا لستُ أنت...',
        'date' => '2024-05-01'
    ],
    [
        'title' => '❖ الحق لا يخشَ شيء',
        'content' => 'إذا كان الحق يخشى...',
        'date' => '2024-05-05'
    ],
    [
        'title' => '❖ تبجيل الجهل',
        'content' => 'لم أرَ تحقيرًا...',
        'date' => '2024-05-10'
    ]
];

// ترتيب المقالات تنازلياً حسب التاريخ (الأحدث أولاً)
usort($articles, function($a, $b) {
    return strtotime($b['date']) - strtotime($a['date']);
});

function arabicDate($date) {
    $months = [
        'January' => 'يناير', 'February' => 'فبراير', 'March' => 'مارس',
        'April' => 'أبريل', 'May' => 'مايو', 'June' => 'يونيو',
        'July' => 'يوليو', 'August' => 'أغسطس', 'September' => 'سبتمبر',
        'October' => 'أكتوبر', 'November' => 'نوفمبر', 'December' => 'ديسمبر'
    ];
    
    $date = new DateTime($date);
    return $date->format('j') . ' ' . $months[$date->format('F')] . ' ' . $date->format('Y');
}
?>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>مقالات - حسين الخليل</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5efff;
      margin: 0;
      padding: 0;
      color: #2f003f;
    }

    nav {
      background-color: #5e2ca5;
      padding: 1em;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin: 0 1em;
      font-weight: bold;
      font-size: 1em;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .container {
      padding: 2em;
      max-width: 900px;
      margin: auto;
      text-align: center;
    }

    h1 {
      color: #5e2ca5;
      margin-bottom: 0.5em;
    }

    p.intro {
      font-size: 1.1em;
      margin-bottom: 2em;
      color: #4a208f;
    }

    .article {
      background-color: #ebddff;
      padding: 1.5em;
      border-radius: 10px;
      margin-bottom: 1.5em;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      text-align: right;
      position: relative;
    }

    .date-sticker {
      background: #7b3fcf;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      display: inline-block;
      margin-bottom: 15px;
      font-size: 0.9em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .article h2 {
      color: #4a208f;
      margin-top: 0;
    }

    .article p {
      line-height: 1.8;
      white-space: pre-line;
      overflow: hidden;
      max-height: 4.5em;
      transition: max-height 0.4s ease;
    }

    .article.expanded p {
      max-height: 1000px;
    }

    .article a.read-more {
      display: inline-block;
      margin-top: 10px;
      color: #6a0dad;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
      transition: transform 0.2s ease, color 0.2s ease;
    }

    .article a.read-more:hover {
      color: #4b0082;
      transform: scale(1.05);
    }

    .favorite-button {
      background-color: #b08cf2;
      color: white;
      padding: 8px 20px;
      border: 2px solid #dcc7fc;
      border-radius: 8px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 14px;
      position: relative;
      transition: transform 0.2s ease;
    }

    .favorite-button.active {
      background-color: #4b0082;
      border-color: #4b0082;
    }

    .favorite-button:hover {
      transform: scale(1.07);
    }

    @media (hover: hover) and (pointer: fine) {
      .favorite-button:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 125%;
        right: 50%;
        transform: translateX(50%);
        background-color: #7b3fcf;
        color: #e8d7ff;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.85em;
        white-space: nowrap;
        opacity: 1;
        pointer-events: none;
        z-index: 10;
      }
    }

    #message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #7b3fcf;
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 15px;
      display: none;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      max-width: 90%;
      text-align: center;
      white-space: nowrap;
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">الرئيسية</a>
    <a href="books.html">الكتب</a>
    <a href="khawatir.html">خواطر</a>
    <a href="videos.html">الفيديوهات</a>
    <a href="ask.html">اطرح سؤالك</a>
    <a href="hewar.html">حوارات</a>
    <a href="favorites.html">المفضلة</a>
    <a href="support.html">ادعمني</a>
    <a href="about.html">عني</a>
  </nav>

  <div class="container">
    <h1>مقالات</h1>
    <p class="intro">في هذه الصفحة أشارك تأملاتي وكتاباتي في التنوير، وقراءة معاصرة للنص، ونقد الموروث بوعي واحترام للعقل.</p>

    <?php foreach ($articles as $article): ?>
    <div class="article">
      <div class="date-sticker">
        📅 <?php echo arabicDate($article['date']); ?>
      </div>
      <h2><?php echo $article['title']; ?></h2>
      <p><?php echo nl2br($article['content']); ?></p>
      <a class="read-more" onclick="toggleArticle(this)">قراءة المزيد</a><br>
      <button class="favorite-button" onclick="toggleFavorite(this, '<?php echo $article['title']; ?>')">⭐</button>
      <button class="favorite-button print-button" onclick="printArticle(this)" data-tooltip="طباعة المقالة">🖨️</button>
    </div>
    <?php endforeach; ?>

  </div>

  <div id="message"></div>

  <script>
    function toggleArticle(link) {
      const article = link.closest('.article');
      article.classList.toggle('expanded');
      link.textContent = article.classList.contains('expanded') ? 'إخفاء النص' : 'قراءة المزيد';
    }

    function toggleFavorite(button, item) {
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      const messageBox = document.getElementById("message");

      const isFavorite = favorites.includes(item);
      if (isFavorite) {
        favorites = favorites.filter(i => i !== item);
        showMessage("تمت إزالة العنصر من المفضلة");
        button.classList.remove("active");
        button.setAttribute("data-tooltip", "أضف إلى المفضلة");
      } else {
        favorites.push(item);
        showMessage("تمت إضافة العنصر إلى المفضلة");
        button.classList.add("active");
        button.setAttribute("data-tooltip", "تمت الإضافة إلى المفضلة");
      }

      localStorage.setItem("favorites", JSON.stringify(favorites));
    }

    function printArticle(button) {
      const article = button.closest(".article").cloneNode(true);
      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write(`
        <html>
          <head>
            <title>طباعة المقالة</title>
            <style>
              body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #2f003f; padding: 2em; direction: rtl; }
              h2 { color: #4a208f; }
              p { line-height: 1.8; white-space: pre-line; }
              .read-more, .favorite-button, .print-button { display: none !important; }
              .date-sticker { background: #7b3fcf; color: white; padding: 6px 12px; border-radius: 20px; }
            </style>
          </head>
          <body>${article.innerHTML}</body>
        </html>
      `);
      printWindow.document.close();
    }

    function showMessage(text) {
      const message = document.getElementById("message");
      message.textContent = text;
      message.style.display = "block";
      setTimeout(() => message.style.display = "none", 2000);
    }

    window.onload = function() {
      const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      document.querySelectorAll(".favorite-button").forEach(button => {
        const item = button.getAttribute("onclick").split("'")[1];
        button.classList.toggle("active", favorites.includes(item));
        button.setAttribute("data-tooltip", favorites.includes(item) 
          ? "تمت الإضافة إلى المفضلة" 
          : "أضف إلى المفضلة");
      });

      document.querySelectorAll(".article").forEach(article => {
        const p = article.querySelector("p");
        const readMore = article.querySelector(".read-more");
        if (p.scrollHeight <= parseFloat(getComputedStyle(p).lineHeight) * 3) {
          readMore.style.display = "none";
        }
      });
    };
  </script>

</body>
</html>
