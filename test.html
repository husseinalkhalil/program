import yt_dlp
import os

def download_video(url):
    # إعدادات التحميل
    ydl_opts = {
        # اختيار أفضل جودة للفيديو وأفضل جودة للصوت ودمجهما
        'format': 'bestvideo+bestaudio/best',
        
        # صيغة الإخراج النهائية (mp4 لضمان عملها على كل الأجهزة)
        'merge_output_format': 'mp4',
        
        # اسم الملف: سيكون بعنوان الفيديو الأصلي
        'outtmpl': '%(title)s.%(ext)s',
        
        # تجاهل الأخطاء البسيطة واستمرار التحميل
        'ignoreerrors': True,
        
        # عدم طباعة تفاصيل كثيرة مزعجة في الشاشة (اختياري)
        'quiet': False,
        
        # مكان الحفظ (الحالي)
        'paths': {'home': os.getcwd()}
    }

    try:
        print(f"جاري معالجة الرابط: {url} ...")
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            # استخراج المعلومات والتحميل
            info = ydl.extract_info(url, download=True)
            video_title = info.get('title', 'Unknown Video')
            print(f"\nتم تحميل الفيديو بنجاح: {video_title}")
            
    except Exception as e:
        print(f"\nحدث خطأ أثناء التحميل: {e}")

if __name__ == "__main__":
    print("--- برنامج تحميل الفيديوهات الشامل ---")
    while True:
        link = input("\nأدخل رابط الفيديو (أو اكتب 'exit' للخروج): ").strip()
        
        if link.lower() == 'exit':
            print("شكراً لاستخدام البرنامج. وداعاً!")
            break
            
        if link:
            download_video(link)
        else:
            print("الرجاء إدخال رابط صحيح.")
